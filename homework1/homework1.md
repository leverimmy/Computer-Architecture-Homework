# 第 1 次作业

## 第 1 题

> 某系统的指令的 CPI 和执行频度如下表所示。
>
> |   指令   |   加法   |   减法   |   乘法   |   移位   |   除法   | 求平方根 |
> | :------: | :------: | :------: | :------: | :------: | :------: | :------: |
> | 指令类型 | 基本指令 | 基本指令 | 基本指令 | 基本指令 | 复杂指令 | 复杂指令 |
> |   CPI    |   $1$    |   $1$    |   $2$    |   $1$    |   $10$   |  $100$   |
> | 执行频度 |  $25\%$  |  $25\%$  |  $15\%$  |  $20\%$  |  $10\%$  |  $5\%$   |
>
> 优化方案：第一种是把乘法操作的 CPI 减至 $1$，第二种是把求平方根操作的 CPI 减至 $50$。试比较两种方案对系统性能的提高程度，并尝试总结系统优化方案的规律。

没有改进之前，整个系统的 CPI 为

$$
\text{CPI}_0 = 1 \times 25\% + 1 \times 25\% + 2 \times 15\% + 1 \times 20\% + 10 \times 10\% + 100 \times 5\% = 7.
$$

若使用第一种方案进行优化，整个系统的 CPI 为

$$
\text{CPI}_1 = 1 \times 25\% + 1 \times 25\% + 1 \times 15\% + 1 \times 20\% + 10 \times 10\% + 100 \times 5\% = 6.85.
$$

若使用第二种方案进行优化，整个系统的 CPI 为

$$
\text{CPI}_2 = 1 \times 25\% + 1 \times 25\% + 2 \times 15\% + 1 \times 20\% + 10 \times 10\% + 50 \times 5\% = 4.5.
$$

因此，第一种优化方案的性能提升为

$$
\frac{\text{CPI}_1 - \text{CPI}_0}{\text{CPI}_0} = \frac{7 - 6.85}{7} \approx 2.1\%
$$

第二种优化方案的性能提升为

$$
\frac{\text{CPI}_2 - \text{CPI}_0}{\text{CPI}_0} = \frac{7 - 4.5}{7} \approx 35.7\%
$$

由此可知，第二种优化方案对系统性能的提升更为显著。

总结来说，系统优化应当优先优化**对总 CPI 贡献最大的指令**，即使其执行频度较低。例如，虽然求平方根运算的执行频度仅为 $5\%$，但它在改进前占整体 CPI 的 $100\times 5\% / 7 \approx 71.4\%$。这体现了“关注热点”的优化原则，即通过减少耗时最长的部分来最大化性能提升。

## 第 2 题

> 假设存储器访问时间占整个程序执行时间的 $30\%$，拟对该存储系统进行性能优化：
>
> - 第一步：采用 L1 Cache，使 $80\%$ 的存储器的访问时间缩短到原来的 $1/4$；
> - 第二步：采用 L2 Cache，使剩余的 $20\%$ 的存储器的访问时间缩短到原来的 $1/2$。
>
> 试计算改进前后整个程序的计算加速比。

设改进前该程序执行时间为 $T_0$，则存储器访问时间为 $0.3T_0$，其余时间为 $0.7T_0$。

使用 L1 Cache 和 L2 Cache 后，存储器访问时间变为

$$
0.8 \times 0.3T_0 \times \frac{1}{4} + 0.2 \times 0.3T_0 \times \frac{1}{2} = 0.09T_0,
$$

故改进前后整个程序的计算加速比为

$$
S_n = \frac{T_0}{0.7T_0 + 0.09T_0} = 1.27.
$$

## 第 3 题

> 假设对系统同时进行两种优化，且方案 1 与 2 无关。
>
> - 方案 1：可改进比例 $\text{Fe}_1$ 和加速比 $\text{Se}_1$
> - 方案 2：可改进比例 $\text{Fe}_2$ 和加速比 $\text{Se}_2$
>
> 试推导系统加速比公式 $S_n$。

设系统优化前所需时间为 $T_0$，则在优化后：
- 不可改进的部分的时间：$(1 - \text{Fe}_1 - \text{Fe}_2)T_0$
- 经方案 1 优化的部分的时间：$T_0 \cdot \text{Fe}_1 / \text{Se}_1$
- 经方案 2 优化的部分的时间：$T_0 \cdot \text{Fe}_2 / \text{Se}_2$

因此，系统加速比为

$$
\begin{align*}
    S_n & = \frac{T_0}{(1 - \text{Fe}_1 - \text{Fe}_2)T_0 + T_0 \cdot \text{Fe}_1 / \text{Se}_1 + T_0 \cdot \text{Fe}_2 / \text{Se}_2} \\
    & = \frac{1}{(1 - \text{Fe}_1 - \text{Fe}_2) + \text{Fe}_1 / \text{Se}_1 + \text{Fe}_2 / \text{Se}_2}
\end{align*}
$$
